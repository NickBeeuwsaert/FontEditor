var items = document.querySelectorAll("canvas"),
transformFunctions = ["translate", "scale", "rotate", "transform"],
icons = {
    "triangle-ruler":"M6.63,21.796l-5.122,5.121h25.743V1.175L6.63,21.796zM18.702,10.48c0.186-0.183,0.48-0.183,0.664,0l1.16,1.159c0.184,0.183,0.186,0.48,0.002,0.663c-0.092,0.091-0.213,0.137-0.332,0.137c-0.121,0-0.24-0.046-0.33-0.137l-1.164-1.159C18.519,10.96,18.519,10.664,18.702,10.48zM17.101,12.084c0.184-0.183,0.48-0.183,0.662,0l2.156,2.154c0.184,0.183,0.184,0.48,0.002,0.661c-0.092,0.092-0.213,0.139-0.334,0.139s-0.24-0.046-0.33-0.137l-2.156-2.154C16.917,12.564,16.917,12.267,17.101,12.084zM15.497,13.685c0.184-0.183,0.48-0.183,0.664,0l1.16,1.161c0.184,0.183,0.182,0.48-0.002,0.663c-0.092,0.092-0.211,0.138-0.33,0.138c-0.121,0-0.24-0.046-0.332-0.138l-1.16-1.16C15.314,14.166,15.314,13.868,15.497,13.685zM13.896,15.288c0.184-0.183,0.48-0.181,0.664,0.002l1.158,1.159c0.183,0.184,0.183,0.48,0,0.663c-0.092,0.092-0.212,0.138-0.332,0.138c-0.119,0-0.24-0.046-0.332-0.138l-1.158-1.161C13.713,15.767,13.713,15.471,13.896,15.288zM12.293,16.892c0.183-0.184,0.479-0.184,0.663,0l2.154,2.153c0.184,0.184,0.184,0.481,0,0.665c-0.092,0.092-0.211,0.138-0.33,0.138c-0.121,0-0.242-0.046-0.334-0.138l-2.153-2.155C12.11,17.371,12.11,17.075,12.293,16.892zM10.302,24.515c-0.091,0.093-0.212,0.139-0.332,0.139c-0.119,0-0.238-0.045-0.33-0.137l-2.154-2.153c-0.184-0.183-0.184-0.479,0-0.663s0.479-0.184,0.662,0l2.154,2.153C10.485,24.036,10.485,24.332,10.302,24.515zM10.912,21.918c-0.093,0.093-0.214,0.139-0.333,0.139c-0.12,0-0.24-0.045-0.33-0.137l-1.162-1.161c-0.184-0.183-0.184-0.479,0-0.66c0.184-0.185,0.48-0.187,0.664-0.003l1.161,1.162C11.095,21.438,11.095,21.735,10.912,21.918zM12.513,20.316c-0.092,0.092-0.211,0.138-0.332,0.138c-0.119,0-0.239-0.046-0.331-0.138l-1.159-1.16c-0.184-0.184-0.184-0.48,0-0.664s0.48-0.182,0.663,0.002l1.159,1.161C12.696,19.838,12.696,20.135,12.513,20.316zM22.25,21.917h-8.67l8.67-8.67V21.917zM22.13,10.7c-0.09,0.092-0.211,0.138-0.33,0.138c-0.121,0-0.242-0.046-0.334-0.138l-1.16-1.159c-0.184-0.183-0.184-0.479,0-0.663c0.182-0.183,0.479-0.183,0.662,0l1.16,1.159C22.312,10.221,22.313,10.517,22.13,10.7zM24.726,10.092c-0.092,0.092-0.213,0.137-0.332,0.137s-0.24-0.045-0.33-0.137l-2.154-2.154c-0.184-0.183-0.184-0.481,0-0.664s0.482-0.181,0.664,0.002l2.154,2.154C24.911,9.613,24.909,9.91,24.726,10.092z",
    "pen": "M13.587,12.074c-0.049-0.074-0.11-0.147-0.188-0.202c-0.333-0.243-0.803-0.169-1.047,0.166c-0.244,0.336-0.167,0.805,0.167,1.048c0.303,0.22,0.708,0.167,0.966-0.091l-7.086,9.768l-2.203,7.997l6.917-4.577L26.865,4.468l-4.716-3.42l-1.52,2.096c-0.087-0.349-0.281-0.676-0.596-0.907c-0.73-0.529-1.751-0.369-2.28,0.363C14.721,6.782,16.402,7.896,13.587,12.074zM10.118,25.148L6.56,27.503l1.133-4.117L10.118,25.148zM14.309,11.861c2.183-3.225,1.975-4.099,3.843-6.962c0.309,0.212,0.664,0.287,1.012,0.269L14.309,11.861z",
    "help":"M16,1.466C7.973,1.466,1.466,7.973,1.466,16c0,8.027,6.507,14.534,14.534,14.534c8.027,0,14.534-6.507,14.534-14.534C30.534,7.973,24.027,1.466,16,1.466z M17.328,24.371h-2.707v-2.596h2.707V24.371zM17.328,19.003v0.858h-2.707v-1.057c0-3.19,3.63-3.696,3.63-5.963c0-1.034-0.924-1.826-2.134-1.826c-1.254,0-2.354,0.924-2.354,0.924l-1.541-1.915c0,0,1.519-1.584,4.137-1.584c2.487,0,4.796,1.54,4.796,4.136C21.156,16.208,17.328,16.627,17.328,19.003z",
    "floppy_disk":"m 13.796588,53.420191 0,0.556929 36.440248,0 0,-0.556929 z m 0,-3.990453 0,0.556928 36.440248,0 0,-0.556928 z m 0,-3.816956 0,0.556928 36.440248,0 0,-0.556928 z m 0,-4.163952 0,0.556929 36.440248,0 0,-0.556929 z m 43.16527,12.638548 0,2.051787 -3.092316,0 0,-2.041898 z m -43.16481,-16.282005 0,0.556928 36.440248,0 0,-0.556928 z m 0,-4.078938 1.75e-4,0.582953 36.440248,0 -1.75e-4,-0.582953 z m -1.924108,-5.133372 40.077404,0 0.441759,0.441726 0,30.341198 -40.970739,0 0,-30.548745 z M 18.527878,4.0234068 c 0,0.1323789 0,0.6987631 0,0.831142 l -6.448779,0 -0.04417,-0.166558 -6.4791399,0 -0.4074011,0.4760784 0,54.3609088 0.4564854,0.451615 c 18.1973686,-0.03279 37.4836446,-8.79e-4 52.8638866,0 l 0.382858,-0.377878 0,-48.431616 -0.37795,-0.378052 0,-1.6147454 0.368133,-0.3681627 0,-0.6528729 -4.132905,-3.4947699 -0.696997,0 -0.333774,0.1963997 -4.393056,0 -0.837457,0 c 0,-0.1323789 0,-0.6987631 0,-0.8311421 C 38.32976,4.023065 27.188311,4.0243089 18.527878,4.0234068 z m 17.023379,3.4266719 c 0,5.0857273 0,10.2575723 0,14.6114793 2.729953,0 5.51074,0 7.848593,0 0,-4.873789 0,-9.747578 0,-14.6213687 -2.740219,-0.00937 -5.493335,0.00451 -7.848593,0.00989 z m -16.43837,-2.8347836 28.743819,0 0,17.5475859 c 0,0.585035 0.02759,0.693992 -0.103075,0.824636 -0.138243,0.138799 -0.41393,0.107569 -0.643005,0.107569 0,0 -24.831333,0.01735 -26.549745,0 -0.84216,0 -1.057854,0.06593 -1.281104,-0.157883 -0.191632,-0.191542 -0.155975,-0.655996 -0.152158,-0.770678 z",
    "new_page":"M 10.5 4.46875 L 10.5 5.46875 L 10.5 58.53125 L 10.5 59.53125 L 11.5 59.53125 L 52.5 59.53125 L 53.5 59.53125 L 53.5 58.53125 L 53.5 25.375 C 53.5 24.436461 53.132895 23.589147 52.53125 22.96875 C 52.469085 22.904647 52.409661 22.841553 52.34375 22.78125 L 35.59375 5.9375 C 35.531744 5.856739 35.442283 5.7948415 35.375 5.71875 C 35.297464 5.6310636 35.241364 5.5184364 35.15625 5.4375 C 35.139936 5.4219869 35.110379 5.4214443 35.09375 5.40625 C 34.462189 4.8291893 33.618176 4.46875 32.6875 4.46875 L 11.5 4.46875 L 10.5 4.46875 z M 12.5 6.46875 L 32.6875 6.46875 C 33.105157 6.46875 33.400272 6.5704635 33.6875 6.8125 C 33.721197 6.8408953 33.747353 6.8740168 33.78125 6.90625 C 33.861957 6.9829958 33.953922 7.0862 34.03125 7.1875 C 34.263233 7.4913999 34.465823 7.8905873 34.65625 8.40625 C 35.164056 9.7813507 35.411744 11.785486 35.46875 13.8125 C 35.582762 17.866527 35 21.96875 35 21.96875 L 34.8125 23.28125 L 36.125 23.125 C 36.125 23.125 40.201804 22.567169 44.21875 22.6875 C 46.227223 22.74767 48.2304 22.972909 49.59375 23.46875 C 50.275425 23.716671 50.792386 24.032993 51.09375 24.34375 C 51.395114 24.654507 51.5 24.935856 51.5 25.375 L 51.5 57.53125 L 12.5 57.53125 L 12.5 6.46875 z M 37.15625 10.3125 L 47.78125 21 C 46.656891 20.824674 45.46529 20.722969 44.28125 20.6875 C 41.051884 20.59076 38.4646 20.845879 37.125 21 C 37.288094 19.638721 37.560138 16.999575 37.46875 13.75 C 37.43581 12.578728 37.331498 11.419732 37.15625 10.3125 z ",
    "logo":"M 17.212904,-21.397845 -21.374999,89.373945 89.396784,127.96184 128,17.190065 z m 71.601999,80.20772 c 2.585914,0.008 4.932671,0.44416 6.722258,1.0872 4.499529,1.61678 7.183319,5.72182 6.125059,8.66696 -0.88825,2.72911 -3.498362,3.26518 -5.298176,2.61847 -1.881619,-0.67611 -2.919166,-2.15044 -3.843477,-4.97662 -0.534395,-1.85472 -1.328791,-3.24516 -3.292222,-3.95066 -2.20886,-0.7937 -4.819382,-0.7183 -7.242889,0.62781 -5.344245,2.79068 -7.908364,9.44336 -9.907291,15.00641 l -0.597193,1.6231 11.867311,4.2723 c 3.108764,1.117 6.334095,1.6316 9.432599,2.0059 0.795077,0.101 1.270098,0.084 1.760956,0.2603 0.572669,0.2058 0.425398,0.6052 0.137814,1.1485 -0.745161,1.3026 -2.59129,6.4645 -5.23693,13.827395 l -3.215659,8.91191 c -1.146445,3.19059 -2.208477,6.14509 -2.450025,7.07449 -0.529128,1.47251 -0.430886,2.23871 0.796258,2.6797 l 3.521912,1.2709 c 0.572669,0.2058 0.65107,0.5045 0.474692,0.9953 l -0.535943,1.4701 c -0.176377,0.4908 -0.427902,0.6816 -0.91876,0.5053 -0.654475,-0.2352 -2.609512,-1.22589 -7.763518,-3.0779 -4.826766,-1.7343 -7.2823,-2.3398 -8.100397,-2.6338 -0.409047,-0.147 -0.605132,-0.3972 -0.428755,-0.8881 l 0.597194,-1.6384 c 0.176377,-0.4909 0.468592,-0.558 1.041261,-0.3522 l 3.276909,1.1791 c 0.818098,0.2939 1.379707,0.034 1.990646,-1.40879 l 2.587839,-7.2123 4.410047,-12.265405 c 1.734363,-4.8268 1.13812,-6.5186 -4.670362,-8.6057 l -9.983854,-3.5832 -2.618465,7.2735 c -3.468727,9.653605 -6.164392,17.186805 -6.324129,18.145505 -0.411544,1.14529 -0.604571,2.1787 0.704383,2.6491 l 3.675038,1.3322 c 0.654475,0.2352 0.758258,0.4585 0.581881,0.9494 l -0.52063,1.47 c -0.176378,0.4909 -0.453706,0.7607 -0.780946,0.6432 -0.490858,-0.1764 -2.859336,-1.305 -8.17696,-3.2157 -5.481244,-1.9696 -8.76281,-2.8733 -9.417286,-3.1085 -0.490858,-0.1763 -0.591048,-0.4025 -0.444068,-0.8115 l 0.643132,-1.7916 c 0.14698,-0.4091 0.371472,-0.5262 1.025948,-0.291 l 4.241607,1.5313 c 1.227145,0.4409 1.863006,-0.2504 2.679716,-2.2663 l 5.512557,-15.389205 3.322848,-9.2336 -5.481933,-1.9753 c -0.409048,-0.147 -0.533813,-0.5645 -0.275628,-1.0259 l 1.240326,-2.4194 c 0.258186,-0.46149 0.539911,-0.44958 1.194387,-0.2144 l 4.746925,1.6997 0.490005,-1.3935 c 2.910204,-8.09911 7.289454,-12.05784 12.188878,-14.63886 3.477081,-1.86817 7.210361,-2.56695 10.53511,-2.55721 z"};
    
for(var i =0; i < items.length; i++){
    var element = items[i];
    if(element.hasAttribute("icon-id")){
        var ctx = superCanvas(element);
        ctx.beginPath();
        var transforms = (element.getAttribute("transform")||"").match(/([a-z]+\([0-9\.\-,]*\))/ig)||[];
        for(var t = 0; t < transforms.length; t++){
            console.log(transforms[t]);
            var command = transforms[t].match(/(^[a-z]+|[0-9\.\-]+)/g);
            var func = command.shift();
            if(transformFunctions.indexOf(func)!== -1)
                ctx[func].apply(ctx, command);
        }
        ctx.drawPath(icons[element.getAttribute("icon-id")]);
        ctx.fillStyle=element.getAttribute("color")||"black";
        ctx.fill();
        ctx.closePath();
    }
}
document.addEventListener("click", function(ev){
    var target = ev.target;
    if(target.parentNode.className.match(/(^|\w)toolbar($|\w)/i)){
        
        for(var i = 0; i != target.parentNode.children.length; i++){
            e = target.parentNode.children[i];
            if(e.nodeType == 1){
                e.className = e.className.replace(/(?:^|\s)selected(?:$|\s)/i,"");
            }
        }
        target.className += " selected";
    }
    
    if(target.parentNode.parentNode.className.match(/\btoolbar\b/i)){
        for(var i = 0; i != target.parentNode.parentNode.children.length; i++){
            e = target.parentNode.parentNode.children[i];
            if(e.nodeType == 1){
                e.className = e.className.replace(/(?:^|\s)selected(?!\S)/i,"");
            }
        }
        target.parentNode.className += " selected";
    }/*if(target.parentNode.className.match(/(^|\w)tabBar($|\w)/i)){
        
        for(var i = 0; i != target.parentNode.children.length; i++){
            e = target.parentNode.children[i];
            if(e.nodeType == 1){
                e.className = e.className.replace(/(?:^|\s)active(?:$|\s)/i,"");
            }
        }
        target.className += " active";
    }*/
}, false);

